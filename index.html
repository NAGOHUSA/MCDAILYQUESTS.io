<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MC Daily Quests</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #111;
      --stone: #1d1d1d;
      --grass: #4CAF50;
      --gold: #FFD700;
      --accent: #8BC34A;
      --lava: #FF5722;
    }

    * { box-sizing: border-box; }
    body {
      background: var(--bg);
      font-family: 'Press Start 2P', cursive;
      color: #fff;
      padding: 1rem;
      margin: 0;
    }

    h1 {
      text-align: center;
      color: var(--gold);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .section {
      background: var(--stone);
      border: 4px solid var(--grass);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 10px #000;
    }

    input, button {
      padding: 0.6rem;
      font-family: inherit;
      font-size: 1rem;
      margin: 0.5rem 0;
    }

    input { width: calc(100% - 1rem); }
    button {
      background: var(--grass);
      color: white;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background: #43a047;
    }

    .quest-block h2 { color: var(--gold); font-size: 1.2rem; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    .archive-card {
      background: #2a2a2a;
      padding: 1rem;
      border: 2px solid var(--grass);
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      border: 1px solid #444;
      padding: 0.5rem;
      text-align: left;
    }

    .avatar {
      width: 24px;
      height: 24px;
      vertical-align: middle;
      margin-right: 8px;
      border-radius: 4px;
    }

    #myStats {
      display: none;
      font-size: 0.9rem;
      margin-top: 1rem;
    }

    @media(max-width: 600px) {
      h1 { font-size: 1.2rem; }
      input, button { font-size: 0.9rem; }
      table { font-size: 0.8rem; }
    }
  </style>
</head>
<body>

<h1>MC DAILY QUESTS</h1>

<div class="section">
  <div id="quest">Loading quest...</div>
</div>

<div class="section">
  <h2>üéÆ Submit Your Quest</h2>
  <input type="text" id="player" placeholder="Your Minecraft username" />
  <input type="text" id="seed" placeholder="Your world seed..." />
  <button onclick="submitQuest()">Attach & Share</button>
  <div id="submitStatus"></div>
</div>

<div class="section">
  <h2>üìú Quest Archive</h2>
  <div class="grid" id="archive"><div>Loading...</div></div>
</div>

<div class="section">
  <h2>üèÜ Leaderboard</h2>
  <div id="questHero">Loading top player...</div>
  <table id="leaderboardTable">
    <thead>
      <tr><th>#</th><th>Player</th><th>Score</th></tr>
    </thead>
    <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
  </table>

  <div id="myStats">
    <p>üìä Your Stats:</p>
    <p><img id="statAvatar" class="avatar" src="" /> <strong id="statName"></strong></p>
    <p>‚≠ê Score: <span id="statScore"></span></p>
    <p>üèÖ Rank: <span id="statRank"></span></p>
  </div>
</div>

<div class="section">
  <h2>üìî Your Adventure Log</h2>
  <div id="log">No quests submitted yet.</div>
</div>

<script>
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx9YCDjzo6GE-sRHgLwU9ZzWeLdC2ugK5t0mc7uJsg8b0nl-7ec59JOewFopLzlPlKurQ/exec';
  const today = new Date().toISOString().split('T')[0];

  async function loadQuest(date, container = 'quest') {
    const url = `https://raw.githubusercontent.com/NAGOHUSA/MCQUESTS/main/quests/${date}.json`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Not found');
      const q = await res.json();
      document.getElementById(container).innerHTML = `
        <div class="quest-block">
          <h2>${q.title}</h2>
          <p><em>${q.lore}</em></p>
          <h3>Steps:</h3>
          <ol>${q.steps.map(s => `<li>${s}</li>`).join('')}</ol>
          <h3>Reward:</h3><p>${q.reward}</p>
          <p><strong>Start Biome:</strong> ${q.biomeHint}</p>
          <p><small>ID: ${q.id}</small></p>
        </div>
      `;
    } catch {
      document.getElementById(container).innerHTML = `<p class="empty">Today's quest not found.</p>`;
    }
  }

  async function submitQuest() {
    const player = document.getElementById('player').value.trim();
    const seed = document.getElementById('seed').value.trim();
    if (!player) return alert('Enter your Minecraft username!');
    const payload = {
      player,
      questID: today,
      seed,
      score: 1
    };
    document.getElementById('submitStatus').textContent = 'Submitting...';
    try {
      const res = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(payload)
      });
      const txt = await res.text();
      document.getElementById('submitStatus').textContent = txt.includes('Success') ? '‚úÖ Submitted!' : `‚ö†Ô∏è ${txt}`;
      saveLocalQuest(player, today, seed);
      loadLeaderboard(player);
    } catch (err) {
      document.getElementById('submitStatus').textContent = '‚ùå Error submitting.';
    }
  }

  function saveLocalQuest(player, quest, seed) {
    localStorage.setItem('mcqPlayer', player);
    const log = JSON.parse(localStorage.getItem('nagohQuests') || '[]');
    log.push({ player, quest, seed, date: new Date().toLocaleDateString() });
    localStorage.setItem('nagohQuests', JSON.stringify(log));
    updateLog();
  }

  function updateLog() {
    const log = JSON.parse(localStorage.getItem('nagohQuests') || '[]');
    const div = document.getElementById('log');
    div.innerHTML = log.length === 0
      ? 'No quests submitted yet.'
      : log.map(l => `‚Ä¢ ${l.date} ‚Äì <strong>${l.player}</strong> ‚Äì Quest ${l.quest}`).join('<br>');
  }

  async function loadLeaderboard(currentPlayer = '') {
    try {
      const res = await fetch(GOOGLE_SCRIPT_URL);
      const data = await res.json();
      const tbody = document.querySelector('#leaderboardTable tbody');
      tbody.innerHTML = '';
      let topPlayer = data[0]?.player || '';
      data.forEach((p, i) => {
        const avatar = `<img class="avatar" src="https://minotar.net/avatar/${p.player}/32" alt="${p.player}" />`;
        tbody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${avatar}${p.player}</td>
            <td>${p.score}</td>
          </tr>`;
      });
      document.getElementById('questHero').innerHTML = `üéâ Hero of the Day: <strong>${topPlayer}</strong>`;
      if (currentPlayer) {
        const me = data.find(p => p.player.toLowerCase() === currentPlayer.toLowerCase());
        if (me) {
          const rank = data.findIndex(p => p.player.toLowerCase() === currentPlayer.toLowerCase()) + 1;
          document.getElementById('statName').textContent = me.player;
          document.getElementById('statScore').textContent = me.score;
          document.getElementById('statRank').textContent = rank;
          document.getElementById('statAvatar').src = `https://minotar.net/avatar/${me.player}/32`;
          document.getElementById('myStats').style.display = 'block';
        }
      }
    } catch (err) {
      document.querySelector('#leaderboardTable tbody').innerHTML = '<tr><td colspan="3">Error loading leaderboard</td></tr>';
    }
  }

  async function loadArchive() {
    const dates = ['2025-11-01', '2025-11-02', '2025-11-03', '2025-11-04'];
    const archive = document.getElementById('archive');
    archive.innerHTML = '';
    for (let i = 0; i < dates.length; i++) {
      const card = document.createElement('div');
      card.className = 'archive-card';
      card.id = `a${i}`;
      archive.appendChild(card);
      loadQuest(dates[i], `a${i}`);
    }
  }

  // INIT
  (async () => {
    loadQuest(today, 'quest');
    loadArchive();
    updateLog();
    const savedPlayer = localStorage.getItem('mcqPlayer');
    if (savedPlayer) {
      document.getElementById('player').value = savedPlayer;
      loadLeaderboard(savedPlayer);
    } else {
      loadLeaderboard();
    }
  })();
</script>

</body>
</html>
